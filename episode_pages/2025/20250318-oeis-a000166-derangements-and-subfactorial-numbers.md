# OEIS A000166 Derangements and Subfactorial Numbers

**Published:** March 18, 2025  
**Duration:** 9m 41s  
**Episode ID:** 17692942

ðŸŽ§ **[Listen to this episode](https://intellectuallycurious.buzzsprout.com/2529712/episodes/17692942-oeis-a000166-derangements-and-subfactorial-numbers)**

## Description

Learn about OEIS A000166 Derangements and Subfactorial Numbers

## Transcript

Welcome back everyone to our ongoing deep dive into these fascinating integer sequences over on the OEIS. For number theory enthusiasts like you, this is really just an absolute treasure trove. Today we're going to tackle sequence AOG 00166, also known as derangements or subfactorial numbers. So imagine a professor handing back graded tests, right? But nobody gets their own test back. That's a derangement in action. And we're going to unpack the math behind it all with a very special guest, a Fields Medal winning mathematician. Oh, it's a pleasure to be here. The OEIS is truly remarkable. A living testament to the beauty and interconnectedness of mathematics. This sequence in particular is a wonderful example of how a seemingly simple concept can lead to some pretty profound mathematical insights. Okay, so let's start with the basics. What exactly are derangements? A derangement is a permutation of objects where none of the objects end up in their original position. Like you said, think of those mixed up test papers. If we label students A, B, C, and D, a derangement means student A doesn't get test A, student B doesn't get test B, and so on. Yeah, the Wikipedia page for derangements has a helpful visual showing four student papers being handed back. Out of the 24 possible permutations, only nine are derangements, since you can see it laid out like that. Absolutely. And the number of derangements for a set of N objects is denoted by N called the subfactorial of N. The OEIS entry for A000166 lists the first few terms, 1, 0, 1, 2, 9, 4, 4, 2, 65, and so on. And here's where it gets really interesting. The subfactorial N is the closest integer to NE. Wait, E, the E from calculus. What's that doing here? I wouldn't have guessed there'd be a connection to derangements. It is a bit surprising at first glance. This connection emerges when you delve into the formulas for calculating derangements. But before we get into the formulas themselves, let's take a detour to another classic problem that illustrates derangements, the hat check problem. Ah, yes. You have N hats and N people and nobody gets their own hat back. It's like the student test scenario, but with hats. That's a recipe for a very chaotic party. Precisely. Now, how do we actually calculate these subfactorials? There are a couple of fascinating ways. One is through a recursive formula, N equals N1 multiplied by the sum of N1 and N2. So to calculate a subfactorial, you need the values of the two preceding subfactorials. It builds on itself. Can you give us an example of how this works in practice? Certainly. Let's say we want to calculate 0.4, the number of derangements of four objects. Using the recursive formula, we need 0.3 and 0.2. From the OEIS sequence, we know 0.3 is 2 and 0.2 is 1. So 0.4 is 4 to 1 times 2 plus 1, which equals 9. That's pretty neat. It's like a mathematical chain reaction. But I see there's also a non-recursive formula listed in the OEIS entry. Yes, there is. And this one involves a powerful concept from combinatorics called the inclusion-exclusion principle. Essentially, this principle provides a systematic way to count the number of elements in a union of sets, ensuring we don't overcount elements that belong to multiple sets. So how does this principle apply to calculating derangements? It sounds rather abstract. Imagine you're trying to count all the possible derangements. You could start by counting all permutations and then subtract those where at least one element is in its original position. But you've now subtracted too much because you've double-counted permutations where two elements are in their original positions. So you add those back in, and then you realize you've overcounted permutations with three fixed points, so you subtract again. This back-and-forth process is the essence of the inclusion-exclusion principle, and it leads to a formula for .n that doesn't rely on previous terms in the sequence. Wow, that's a lot to wrap my head around. But I'm starting to see how this seemingly simple concept of derangements has these deeper mathematical underpinnings. And I notice the OEIS formula section lists even more formulas. That's right. The depth and variety of formulas for calculating derangements speak to the richness of this sequence. Each formula provides a different lens through which to view and understand this concept. This is already more fascinating than I expected. I have a feeling it gets even more intriguing from here. You're absolutely right. Derangements are not just a standalone concept. They extend and connect to a variety of other mathematical ideas and problems, which we'll explore further. Okay, I'm ready for the next level. Let's dive in. So we've got a good grasp on how to calculate these subfactorials, but where do they actually pop up in the real world? Well, one area is cryptography. Think about designing secure shuffling algorithms, you know, to make data unpredictable. Derangements are really important there. So the more deranged the shuffling, the harder it is to crack the code. Makes sense. And the OEIS entry mentions something about necklaces. It says A-N is also the number of unordered necklaces with N beads, each labeled differently, where each necklace has at least two beads. Okay, I can picture that. Each bead is out of its original position, just like an end derangement. What else? There's even a connection to game theory, believe it or not. The OEIS entry notes that A-N represents the maximum number of totally mixed Nash equilibria in games with N players each having two pure options. Nash equilibria, like the concept from A Beautiful Mind. I didn't expect that to show up here. It's the same idea. A Nash equilibrium is a state where no player can improve their outcome by unilaterally changing their strategy, assuming the other player's strategy stayed the same. It's fascinating that derangements help determine the maximum number of these equilibria in certain games. Wow, it's clear that derangements are more than just a theoretical curiosity. They have real-world applications in fields I never would have imagined. Absolutely. And remember how we mentioned that the subfactorial is the nearest integer to N-E? Well, as an N gets larger, the ratio of N-N approaches 1 over E. So as we deal with larger and larger sets, roughly 37% of all possible permutations are actually derangements. That seems counterintuitive. You'd think with more elements, it would be easier to get at least one in its original spot. That's a great observation. It highlights how, as the size of the set increases, the likelihood of having at least one element in its original position becomes almost certain, making derangements relatively rare. That makes the connection to E even more intriguing. Indeed. And the OEIS source even mentions a formula connecting our sequence A000166 to another sequence A000255. This shows how interconnected these sequences are within the OEIS, often revealing hidden relationships and patterns. It's like this giant web of mathematical connections with derangements being one of the key nodes. But let's not get too lost in the web just yet. We've talked about the concept calculation and applications of derangements. But what about some of the deeper mathematical connections you mentioned earlier? If we look at the asymptotic expansion of N, we find a link to another important sequence, the Bell numbers. Bell numbers? What are those all about? Bell numbers represent the number of ways to partition a set into non-empty subsets. The asymptotic expansion provides a way to approximate the subfactorial using Bell numbers. So even the way we approximate derangements involves another cool combinatorial concept. It's all connected. What's fascinating here is that the deeper we go, the more connections we find. And it makes you wonder what else is out there. Are there still undiscovered connections and applications of derangements waiting to be found? I think so. I'm inclined to agree. This entire deep dive has been full of surprises. But we're nearing the end of our exploration of derangements. Yes. Let's wrap up this part of our discussion and move on to some final thoughts about this captivating sequence. So we've really journeyed through the world of derangements today. We started with that basic idea, you know, permutations where nothing stays in place. Then we explored how to calculate these subfactorial numbers, both with that neat recursive formula and through that mind-bending inclusion-exclusion principle. And it turns out they're not just a mathematical puzzle. Derangements have applications in cryptography, computer science, even game theory. Yeah, what's particularly striking is how the concept of derangements, which initially seems quite simple, you know, connects to some profound mathematical ideas. The link to the constants is a prime example. And the fact that we can approximate subfactorials using Bell numbers highlights the interconnectedness of seemingly disparate areas of mathematics. It's like pulling on a thread and realizing it's connected to a whole tapestry of mathematical concepts. And speaking of connections, we can't forget that formula in the OEIS linking our sequence A000166 to another sequence A000255. It really shows how deep this rabbit hole goes. But before we get too lost in the web of connections, let's bring it back to our main star, derangements. Indeed. As with any good mathematical exploration, we're left with more questions than answers. And one particularly intriguing question comes from Zihui Sun. The OEIS entry mentions his conjecture. For N greater than 2, the subfactorial N is a perfect power only when N equals 4, where .4 equals 3 squared. This has been verified for values of N up to 1,000, but a general proof

---
*This episode was generated from the Intellectually Curious Podcast. For more episodes, visit our [main site](https://intellectuallycurious.buzzsprout.com).*
